<div class="content pt-2">
  <div class="container-fluid">

    <div class="row mx-1 px-2 py-2 border cabecera sombra align-items-center flex-nowrap">

      <!-- Título -->
      <div class="col-auto mr-3">
        <h6 class="font-weight-bold mb-0 text-nowrap">
          <i class="fa fa-history"></i>&nbsp; Simulación del nuevo Pliego Tarifario
        </h6>
        <small class="text-muted d-block text-nowrap">
          Opciones, categoría y consumo
        </small>
      </div>

      <!-- Formulario -->
      <form [formGroup]="formBuscar" class="d-flex align-items-center flex-nowrap w-100">

        <!-- AP / AM -->
        <div class="d-flex align-items-center px-2 py-1 border rounded bg-light mr-2">
          <label class="mb-0 d-flex align-items-center mr-3 text-nowrap">
            <span class="mr-1 font-weight-bold">ALC.</span>
            <input type="checkbox" formControlName="swAguapotable">
          </label>

          <label class="mb-0 d-flex align-items-center text-nowrap">
            <span class="mr-1 font-weight-bold">AM</span>
            <input type="checkbox" formControlName="swAdultoMayor">
          </label>
          <label class="mb-0 d-flex align-items-center text-nowrap">
            <span class="mr-1 font-weight-bold">MUN</span>
            <input type="checkbox" formControlName="swMunicipio">
          </label>
        </div>

        <!-- Categoría -->
        <div class="mr-2">
          <select class="custom-select custom-select-sm text-nowrap" formControlName="categoria">
            <option *ngFor="let categoria of categorias" [ngValue]="categoria.idcategoria">
              {{ categoria.descripcion }}
            </option>
          </select>
        </div>

        <!-- Consumo rango -->
        <div class="input-group input-group-sm mr-2" style="width: 280px;">
          <div class="input-group-prepend">
            <span class="input-group-text">m³ Desde</span>
          </div>
          <input type="number" class="form-control text-center" formControlName="m3Desde">

          <div class="input-group-prepend">
            <span class="input-group-text">Hasta</span>
          </div>
          <input type="number" class="form-control text-center" formControlName="m3Hasta">
        </div>

        <!-- Botones -->
        <div class="d-flex align-items-center ml-auto">
          <button type="button" class="btn btn-success btn-sm mr-2" (click)="calcular()">
            <i class="fa fa-check-circle"></i>&nbsp;Aceptar
          </button>

          <button type="button" class="btn btn-outline-success btn-sm" (click)="regresar()">
            <i class="fa fa-times-circle"></i>&nbsp;Cancelar
          </button>
        </div>

      </form>

    </div>

  </div>
</div>

<!-- ================= TABLA ================= -->
<div class="table-responsive sombra mt-2 tabla-scroll">
  <table class="table table-hover table-bordered table-striped table-sm sombra mt-2">

    <thead class="cabecera thead-fija">
      <tr class="text-center">
        <th rowspan="2">m³</th>
        <th colspan="3">Pliego tarifario 2024</th>
        <th colspan="2">Conservación fuentes</th>
        <th colspan="2">Rubro de basura</th>
        <th *ngIf="hayExcedentes" rowspan="2">Excedentes</th>
        <th rowspan="2">Total</th>
        <th rowspan="2"></th>
      </tr>

      <tr class="text-center">
        <th>Agua Potable</th>
        <th>Alcantarillado</th>
        <th>Saneamiento</th>
        <th>Comuna</th>
        <th>EPMAPA-T</th>
        <th>Municipio</th>
        <th>Recaudación</th>
      </tr>
    </thead>

    <tbody class="detalle">

      <tr *ngFor="let row of filasPliego" [ngClass]="{ 'fila-exceso': row.swCambioCategoria }">
        <td class="text-center font-weight-bold">{{ row.m3 }}</td>

        <td class="text-right">{{ row['Agua Potable'] | number:'1.2-2' }}</td>
        <td class="text-right">{{ row['Alcantarillado'] | number:'1.2-2' }}</td>
        <td class="text-right">{{ row['Saneamiento'] | number:'1.2-2' }}</td>
        <td class="text-right">{{ row['Conservacion Fuentes'] | number:'1.2-2' }}</td>
        <td class="text-right">{{ row['Conservacion Fuentes Epmapat'] | number:'1.2-2' }}</td>
        <td class="text-right">{{ row['Recoleccion Basura'] | number:'1.2-2' }}</td>
        <td class="text-right">{{ row['Recaudacion Basura'] | number:'1.2-2' }}</td>

        <td *ngIf="hayExcedentes" class="text-right">
          {{ row['Excedente'] | number:'1.2-2' }}
        </td>

        <td class="text-right font-weight-bold">
          {{ row['Total'] | number:'1.2-2' }}
        </td>

        <td class="text-center">
          <i class="fa fa-check-circle text-success"></i>
        </td>
      </tr>

      <tr *ngIf="filasPliego.length === 0">
        <td colspan="11" class="text-center text-muted py-3">
          No hay resultados
        </td>
      </tr>

    </tbody>

  </table>
</div>
