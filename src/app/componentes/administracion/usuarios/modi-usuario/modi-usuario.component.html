<!-- Header -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mt-5 justify-content-center text-center">
      <div class="col-sm-7 cabecera sombra border">
        <h5 class="mt-2 font-weight-bold mb-2">Modificar Usuario</h5>
      </div>
    </div>
  </div>
</div>

<!-- Content -->
<div class="content">
  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="card card-body col-sm-7 detalle sombra">

        <form [formGroup]="formUsuario" autocomplete="off">

          <div class="row">

            <!-- Identificación -->
            <div class="form-group col-md-6 mb-2">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label class="input-group-text font-weight-bold" for="identificausu">Identificación</label>
                </div>
                <input
                  id="identificausu"
                  type="text"
                  class="form-control"
                  formControlName="identificausu"
                  [ngClass]="{
                    'is-invalid': f['identificausu'].invalid && f['identificausu'].touched,
                    'is-valid': f['identificausu'].valid && f['identificausu'].touched
                  }"
                />
              </div>
              <div class="invalid-feedback" *ngIf="f['identificausu'].invalid && f['identificausu'].touched">
                Verifique la identificación.
              </div>
            </div>

            <!-- Alias -->
            <div class="form-group col-md-6 mb-2">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label class="input-group-text font-weight-bold" for="alias">Alias</label>
                </div>
                <input
                  id="alias"
                  type="text"
                  class="form-control"
                  formControlName="alias"
                  [ngClass]="{
                    'is-invalid': f['alias'].invalid && f['alias'].touched,
                    'is-valid': f['alias'].valid && f['alias'].touched
                  }"
                />
              </div>
              <div class="invalid-feedback" *ngIf="f['alias'].invalid && f['alias'].touched">
                Verifique el alias.
              </div>
            </div>

            <!-- Nombre -->
            <div class="form-group col-md-12 mb-2">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label class="input-group-text font-weight-bold" for="nomusu">Nombre</label>
                </div>
                <input
                  id="nomusu"
                  type="text"
                  class="form-control"
                  formControlName="nomusu"
                  autocomplete="name"
                  [ngClass]="{
                    'is-invalid': f['nomusu'].invalid && f['nomusu'].touched,
                    'is-valid': f['nomusu'].valid && f['nomusu'].touched
                  }"
                />
              </div>
              <div class="invalid-feedback" *ngIf="f['nomusu'].invalid && f['nomusu'].touched">
                Ingrese el nombre.
              </div>
            </div>

            <!-- Contraseña / Reingreso -->
            <div class="form-group col-md-6 mb-2">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label class="input-group-text font-weight-bold" for="codusu">Contraseña</label>
                </div>
                <input
                  id="codusu"
                  type="password"
                  class="form-control"
                  formControlName="codusu"
                  autocomplete="new-password"
                  [ngClass]="{
                    'is-invalid': f['codusu'].invalid && f['codusu'].touched,
                    'is-valid': f['codusu'].valid && f['codusu'].touched
                  }"
                />
              </div>
              <div class="invalid-feedback" *ngIf="f['codusu'].invalid && f['codusu'].touched">
                Verifique la contraseña.
              </div>
            </div>

            <div class="form-group col-md-6 mb-2">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label class="input-group-text font-weight-bold" for="reingreso">Reingreso</label>
                </div>
                <input
                  id="reingreso"
                  type="password"
                  class="form-control"
                  formControlName="reingreso"
                  autocomplete="new-password"
                  [ngClass]="{
                    'is-invalid': f['reingreso'].invalid && f['reingreso'].touched,
                    'is-valid': f['reingreso'].valid && f['reingreso'].touched
                  }"
                />
              </div>
              <div class="invalid-feedback" *ngIf="f['reingreso'].invalid && f['reingreso'].touched">
                Confirme la contraseña.
              </div>
            </div>

            <!-- Estado -->
            <div class="form-group col-md-12 mb-0" *ngIf="idusuarioModi > 1">
              <div class="custom-control custom-checkbox">
                <input id="estado" type="checkbox" class="custom-control-input" formControlName="estado">
                <label class="custom-control-label font-weight-bold" for="estado">Habilitado</label>
              </div>
            </div>

          </div>

          <!-- Actions -->
          <div class="mt-3 text-center">
            <button
              type="button"
              class="btn btn-outline-primary btn-sm mx-1"
              data-toggle="modal"
              data-target="#modalPersonal"
            >
              <i class="fa fa-search"></i> Buscar personal
            </button>

            <button type="button" class="btn btn-outline-secondary btn-sm mx-1" (click)="regresar()">
              <i class="fa fa-arrow-left"></i> Cancelar
            </button>

            <button
              type="button"
              class="btn btn-success btn-sm mx-1"
              [disabled]="formUsuario.pristine || !formUsuario.valid"
              (click)="guardar()"
            >
              <i class="fa fa-check-circle"></i> Guardar
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Unir Personal to Usuario -->
<div
  class="modal fade"
  id="modalPersonal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="modalPersonalTitle"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="modalPersonalTitle">Buscar Personal</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">

        <div class="row">
          <div class="col-sm-12">
            <label class="w-100 mb-0">
              Buscar Personal
              <input
                type="text"
                [(ngModel)]="filtrarPersonal"
                class="form-control form-control-sm"
                placeholder="Ingrese nombre o identificación"
              />
            </label>
            <small class="text-muted">Tip: puedes buscar por apellidos, nombres o cédula.</small>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-sm-12 table-responsive">
            <table class="table table-hover table-sm mb-0">
              <thead class="thead-light text-center">
                <tr>
                  <th style="width: 60px;">N°</th>
                  <th>Identificación</th>
                  <th>Nombre</th>
                  <th>Cargo</th>
                  <th style="width: 120px;">Acción</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let per of _personal | filter:filtrarPersonal; let i = index" class="text-center">
                  <td>{{ i + 1 }}</td>
                  <td>{{ per.identificacion }}</td>
                  <td class="text-left">{{ per.apellidos }} {{ per.nombres }}</td>
                  <td class="text-left">{{ per.idcargo_cargos.descripcion }}</td>
                  <td>
                    <button type="button" class="btn btn-sm btn-success" (click)="unirPersonal(per)" data-dismiss="modal">
                      <i class="fa fa-link"></i> Unir
                    </button>
                  </td>
                </tr>

                <tr *ngIf="(_personal | filter:filtrarPersonal)?.length === 0">
                  <td colspan="5" class="text-center text-muted py-3">
                    No se encontraron resultados.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-outline-secondary" data-dismiss="modal">
          Cerrar
        </button>
      </div>

    </div>
  </div>
</div>
