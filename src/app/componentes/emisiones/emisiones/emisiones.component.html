<div class="content mt-1 pt-1 pl-0">
   <div class="container-fluid">
      <div class="row m-0 px-0 py-1 justify-content-start titEmisiones">
         <div class="col-sm-2">
            <h4 class="m-0 font-weight-bold"><i class="bi bi-moisture"></i>&nbsp; Emisiones</h4>
         </div>
         <div class="col-sm-8">
            <div class="row">
               <form [formGroup]="formBuscar" (ngSubmit)="buscar()">
                  <div class="row col-sm-12 mt-0 mb-0">
                     <div class="col-sm-12">
                        <div class="row">
                           <div class="col-sm-3">
                              <input type="text" placeholder="Desde" class="form-control form-control-sm text-center"
                                 autofocus id="desde" formControlName="desde" required minlength="4" maxlength="4" />
                           </div>
                           <div class="col-sm-3">
                              <input type="text" placeholder="Hasta" class="form-control form-control-sm text-center"
                                 autofocus id="hasta" formControlName="hasta" required minlength="4" maxlength="4" />
                           </div>
                           <div class="col-sm-3">
                              <button class="btn btn-primary btn-sm" [disabled]="disabled"><i class="fa fa-search"></i>
                                 Buscar</button>
                           </div>

                        </div>
                     </div>
                  </div>
               </form>
               <div class="col-sm-3 px-0" *ngIf="showDiv">
                  <input type="text" class="form-control form-control-sm text-center" placeholder="Filtrar..."
                     [(ngModel)]="filtro" (ngModelChange)="onInputChange()"/>
               </div>
            </div>
         </div>

         <div class="btn-group ml-auto">
            <button type="button" class="bg-transparent border-0 dropdown-toggle text-white" data-toggle="dropdown"
               aria-expanded="false"> <i class="bi-menu-button-wide text-white"></i>
            </button>
            <div class="dropdown-menu dropdown-menu-right bg-dark roboto">
               <button class="dropdown-item" type="button" data-toggle="modal" data-target="#addEmision"
                  (click)="nuevo()" [disabled]="cerrado == 0">
                  <i class="bi-file-earmark-plus"></i>&nbsp; Nuevo</button>
               <button class="dropdown-item" type="button" data-toggle="modal" data-target="#imprimir">
                  <i class="bi bi-printer"></i>&nbsp; Imprimir</button>
               <button class="dropdown-item" type="button" data-toggle="modal" data-target="#exportar"
               (click)="exportar0()">
                  <i class="bi-file-earmark-arrow-up"></i>&nbsp; Exportar </button>
            </div>
         </div>

      </div>
   </div>
</div>

<div class="container-fluid">
   <div class="row mb-0">
      <div class="col-sm-4">
         <table class="table table-hover table-bordered table-sm">
            <thead>
               <tr class="text-center">
                  <th></th>
                  <th>Emisión</th>
                  <th>M<sup>3</sup></th>
                  <th>Est</th>
               </tr>
            </thead>
            <tbody>
               <tr *ngFor="let emision of _emisiones; let i = index"
                  [ngClass]="{'font-weight-bold': emision.estado == 0}" (click)="info(emision, i)">
                  <td class="small text-center font-weight-bold">{{ i+1 }}</td>
                  <td>{{ emision.emision | nombreEmision }}</td>
                  <td [ngClass]="{'transparente': emision.estado == 0}" class="text-right">{{ emision.m3 | number:'1.0' }}</td>
                  <td class="text-center"><i class="bi-clock-fill font-weight-bold" *ngIf="emision.estado == 0"></i>
                     <i class="bi-door-closed" *ngIf="emision.estado == 1"></i>
                  </td>

               </tr>
            </tbody>
         </table>
      </div>

      <div class="col-sm-8" *ngIf="showDiv">
         <div class="row m-0 mt-1 mb-0 px-0 pt-1 titEmisiones">
            <h6 class="fantacy ml-5">Emisión de {{selEmision|nombreEmision}}</h6>
            <div class="btn-group ml-auto">
               <button type="button" class="bg-transparent border-0 dropdown-toggle text-white" data-toggle="dropdown"
                  aria-expanded="false"> <i class="bi-menu-button-wide text-white"></i>
               </button>
               <div class="dropdown-menu dropdown-menu-right bg-dark roboto">
                  <button class="dropdown-item" type="button" data-toggle="modal" data-target="#cerrarEmision"
                     (click)="cerrar()" [disabled]="!swcerrar">
                     <i class="bi-door-closed"></i>&nbsp; Cerrar emisión</button>
                  <button class="dropdown-item" type="button" data-toggle="modal" data-target="#imprimir1">
                     <i class="bi bi-printer"></i>&nbsp; Imprimir</button>
                     <!-- Era Exportar1() -->
                  <button class="dropdown-item" type="button"  data-toggle="modal" data-target="#exportar" (click)="exportar1()">
                     <i class="bi-file-earmark-arrow-down"></i>&nbsp; Exportar</button>
               </div>
               <div class="btn-group mx-1">
                  <button class="bg-transparent border-0" type="button" (click)="ocultar()">
                     <i class="bi-arrow-left-circle text-white icoRegresar"></i>
                  </button>
               </div>
            </div>
         </div>
         <table class="table table-hover table-bordered table-sm" #miTabla>
            <thead>
               <tr class="text-center">
                  <th></th>
                  <th>Código</th>
                  <th>Ruta</th>
                  <th>F.Cierre</th>
                  <th>M<sup>3</sup></th>
                  <th>Est</th>
               </tr>
            </thead>
            <tbody>
               <tr *ngFor="let rutasxemi of _rutasxemi | filter:filtro; let i=index"
                  (click)="lecturas(rutasxemi.idrutaxemision)">
                  <td class="small text-center font-weight-bold">{{i+1}}</td>
                  <td class="text-center">{{ rutasxemi.idruta_rutas.codigo }}</td>
                  <td>{{ rutasxemi.idruta_rutas.descripcion }}</td>
                  <td class="text-center">{{ rutasxemi.fechacierre | date:'dd-MM-y'}}</td>
                  <td class="text-right" [ngClass]="{'transparente': rutasxemi.m3 == 0}">{{ rutasxemi.m3 |
                     number:'1.0'}}</td>
                  <td class="text-center">
                     <i class="bi-clock-fill font-weight-bold" *ngIf="rutasxemi.estado == 0"></i>
                     <i class="bi-door-closed" *ngIf="rutasxemi.estado == 1"></i>
                  </td>
               </tr>
               <td *ngIf="!swfiltro" colspan="4" class="text-right font-weight-bold">TOTAL: </td>
               <td *ngIf="!swfiltro" class="text-right font-weight-bold">{{ subtotal | number:'1.0'}}</td>
            </tbody>
         </table>
      </div>
   </div>

   <!-- MODAL Nueva Emisión -->
   <div class="modal fade" id="addEmision" tabindex="-1" aria-labelledby="addEmisionLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
            <!-- <div *ngIf="cerrado; then thenNuevo else elseNuevo"></div> -->

            <!-- <ng-template #thenNuevo> -->
            <div class="modal-header pl-0 py-1 titNuevo">
               <h5 class="modal-title w-100 text-center">Nueva Emisión</h5>
            </div>
            <div class='modal-body bodyNuevo Roboto'>
               <form [formGroup]="formAddEmision" id="formRubro" *ngIf="cerrado">

                  <div class="form-group col-md-4 mt-1">
                     <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                           <span class="input-group-text font-weight-bold">Emisión</span>
                        </div>
                        <input type="text" class="form-control text-center" formControlName="emision" minlength="4"
                           maxlength="4" required readonly>
                     </div>
                  </div>

                  <div class="form-group col-md-12">
                     <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                           <span class="input-group-text font-weight-bold">Observaciones</span>
                        </div>
                        <textarea class="form-control" formControlName="observaciones" rows="3"
                           maxlength="254"></textarea>
                     </div>
                  </div>

                  <div class="mt-2 mb-0 text-center">
                     <button type="button" class="btn btn-success btn-sm mb-1" data-dismiss='modal'
                        (click)="saveEmision()">
                        <i class="fa fa-check-circle"></i> Aceptar</button>
                     <button class="btn btn-outline-success btn-sm mx-2 btn-sm mb-1" data-dismiss='modal'>
                        <i class="fa fa-times-circle"></i> Cancelar</button>
                  </div>
               </form>

            </div>
            <!-- </ng-template> -->

            <!-- <ng-template #elseNuevo> -->
            <!-- <div class="modal-header pl-0 py-1 titNuevo">
                  <h5 class="modal-title w-100 text-center fantacy">Mensaje</h5>
               </div>
               <div class='modal-body bodyNuevo Roboto'>
                  <div>
                     <div class="row justify-content-center">
                        <div class="alert alert-warning text-center">
                           <h5><strong>No puede crear una nueva Emisión</strong></h5>
                           ¡ La última Emisión <strong>no</strong> está cerrada !
                        </div>
                     </div>
                     <div class="row justify-content-center">
                        <button type='button' class='btn btn-sm btn-success' data-dismiss='modal'>
                           <i class="fa fa-check-circle"></i>&nbsp; Aceptar</button>
                     </div>
                  </div>
               </div> -->
            <!-- </ng-template> -->
         </div>
      </div>
   </div>

   <!-- MODAL Cerrar -->
   <div class="modal fade" id="cerrarEmision" tabindex="-1" aria-labelledby="cerrarEmisionLabel" data-backdrop="static"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content cuerpo">
            <div *ngIf="abiertos > 0; then thenBlock else elseBlock"></div>

            <ng-template #thenBlock>
               <div class='modal-header py-2 justify-content-center titCerrar'>
                  <h5 class='modal-title font-weight-bold fantacy' id='ModalLabel'>Mensaje</h5>
               </div>
               <div class='modal-body'>
                  <div class="alert alert-warning text-center mt-2">
                     <h5><strong> No puede cerrar</strong></h5>
                     ¡ Hay <strong>{{abiertos}}</strong> Rutas sin cerrar !
                  </div>
                  <div class='row justify-content-center'>
                     <button type='button' class='btn btn-sm btn-success' data-dismiss='modal'>
                        <i class="fa fa-check-circle"></i>&nbsp; Aceptar</button>
                  </div>
               </div>
            </ng-template>

            <ng-template #elseBlock>
               <div class='modal-header py-2 justify-content-center titCerrar'>
                  <h5 class='modal-title font-weight-bold fantacy' id='ModalLabel'>Cerrar</h5>
               </div>
               <div class='modal-body'>
                  <div class="alert alert-info text-center mt-3 mb-0">
                     <h6>¿ Cerrar la emisión de <strong>{{ selEmision|nombreEmision }} ?</strong></h6>
                  </div>
               </div>
               <div class='modal-footer justify-content-center'>
                  <button type='button' class='btn btn-success btn-sm mx-1' data-dismiss='modal'
                     (click)="cerrarEmision()">
                     <i class="fa fa-check-circle"></i>&nbsp; Aceptar</button>
                  <button type='button' class='btn btn-sm btn-outline-success' data-dismiss='modal'>
                     <i class="bi bi-x-circle"></i> Cancelar</button>
               </div>
            </ng-template>
         </div>
      </div>
   </div>

   <!-- MODAL Imprimir-->
   <div class="modal fade" id="imprimir" tabindex="-1" aria-labelledby="imprimirLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-sm">
         <div class="modal-content border">
            <div class='modal-header py-2 justify-content-center cabecera'>
               <h5 class='modal-title font-weight-bold' id='ModalLabel'>Imprimir</h5>
            </div>
            <div class='modal-body cuerpo'>

               <div class="input-group mb-3 input-group-sm">
                  <div class="input-group-prepend">
                     <label class="input-group-text" for="inputGroupSelect01">Reporte</label>
                  </div>
                  <select class="custom-select" id="inputGroupSelect01">
                     <option selected>Lista de Emisiones</option>
                  </select>
               </div>

               <div class="input-group input-group-sm mb-0">
                  <div class="input-group-prepend">
                     <small class="input-group-text">Abrir en otra página</small>
                     <div class="input-group-text">
                        <input type="checkbox" [(ngModel)]="otraPagina">
                     </div>
                  </div>
               </div>

               <div class='row justify-content-center mt-3'>
                  <button type='button' class='btn btn-success btn-sm mx-1' data-dismiss='modal' (click)="pdf()"
                     [attr.data-target]="otraPagina ? null : '#pdf'" data-toggle="modal">
                     <i class="fa fa-check-circle"></i>&nbsp; Aceptar</button>
                  <button type='button' class='btn btn-sm btn-outline-success btn-sm mx-1' data-dismiss='modal'>
                     <i class="bi bi-x-circle"></i> Cancelar</button>
               </div>

            </div>
         </div>
      </div>
   </div>

   <!-- MODAL Imprimir1 Rutas por Emision-->
   <div class="modal fade" id="imprimir1" tabindex="-1" aria-labelledby="imprimirLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-sm">
         <div class="modal-content border">
            <div class='modal-header py-2 justify-content-center cabecera'>
               <h5 class='modal-title font-weight-bold' id='ModalLabel'>Imprimir</h5>
            </div>
            <div class='modal-body cuerpo'>

               <div class="input-group mb-3 input-group-sm">
                  <div class="input-group-prepend">
                     <label class="input-group-text" for="inputGroupSelect01">Reporte</label>
                  </div>
                  <select class="custom-select" id="inputGroupSelect01">
                     <option selected>Lista de Rutas por Emisión</option>
                  </select>
               </div>

               <div class="input-group input-group-sm mb-0">
                  <div class="input-group-prepend">
                     <small class="input-group-text">Abrir en otra página</small>
                     <div class="input-group-text">
                        <input type="checkbox" [(ngModel)]="otraPagina">
                     </div>
                  </div>
               </div>

               <div class='row justify-content-center mt-3'>
                  <button type='button' class='btn btn-success btn-sm mx-1' data-dismiss='modal' (click)="pdf1()"
                     [attr.data-target]="otraPagina ? null : '#pdf'" data-toggle="modal">
                     <i class="fa fa-check-circle"></i>&nbsp; Aceptar</button>
                  <button type='button' class='btn btn-sm btn-outline-success btn-sm mx-1' data-dismiss='modal'>
                     <i class="bi bi-x-circle"></i> Cancelar</button>
               </div>

            </div>
         </div>
      </div>
   </div>

   <!-- MODAL Exportar -->
   <div class="modal fade" id="exportar" tabindex="-1" aria-labelledby="exportarLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-sm">
         <div class="modal-content border">
            <div class='modal-header py-2 justify-content-center cabecera'>
               <h5 class='modal-title font-weight-bold' id='ModalLabel'>Exportar</h5>
            </div>
            <div class='modal-body cuerpo'>

               <div class="form-group  my-0 py-0">
                  <div class="input-group input-group-sm mb-3">
                     <div class="input-group-prepend">
                        <span class="input-group-text font-weight-bold" id="inputGroup-sizing-sm" data-toggle="tooltip"
                           title="Obligatorio y mínimo 3 caracteres">Archivo</span>
                     </div>
                     <input type="text" class="form-control" [(ngModel)]="archExportar" aria-label="Small"
                        aria-describedby="inputGroup-sizing-sm" required minlength="3" maxlength="20">
                  </div>
               </div>

               <div class="row justify-content-center">
                  <button type='button' class='btn btn-success btn-sm mx-1' data-dismiss='modal' data-toggle="modal" (click)="exporta()">
                     <i class="fa fa-check-circle"></i>&nbsp; Aceptar</button>
                  <button type='button' class='btn btn-sm btn-outline-success btn-sm mx-1' data-dismiss='modal'>
                     <i class="bi bi-x-circle"></i> Cancelar</button>
               </div>
            </div>
         </div>
      </div>
   </div>

</div>

<!-- MODAL PDF (En la misma página)-->
<div class='modal fade' id='pdf' tabindex='-1' aria-labelledby='pdf' aria-hidden='true'>
   <div class='modal-dialog modal-sm'>
   </div>
</div>